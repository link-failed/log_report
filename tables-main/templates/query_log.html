{% extends "base.html" %}

{% block content %}
  <table id="data" class="table table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>node_name</th>
        <th>duration</th>
        <th>start_time</th>
        <th>finish_time</th>
        <th>pid</th>
        <th>history</th>
      </tr>
    </thead>
    <tbody>
      {% for record in records %}
        <tr>
          <td></td>
          <td>{{ record.node_name }}</td>
          <td>{{ record.duration }}</td>
          <td>{{ record.start_time }}</td>
          <td>{{ record.finish_time }}</td>
          <td>{{ record.pid }}</td>
          <td id="history_fig">
            <button type="button" data-toggle="modal" data-target="#durationFig">
              Show
            </button>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="modal fade" id="durationFig">
    <div class="modal-dialog modal-lg" style="width:690px;height:485px;">
      <div class="modal-content">
        <div class="modal-header" style="height:45px;">
          <h3 class="modal-title">History Duration</h3>
        </div>
        <div class="modal-body" id="putFig" style="text-align: center;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function () {
      $('#data').DataTable({
        columns: [
          null,
          null,
          {searchable: false},
          {searchable: false},
          {searchable: false},
          {orderable: false, searchable: false},
          {orderable: false, searchable: false}
        ]
      });

      $("#data td:nth-child(3)").each(function () {
        if (parseInt($(this).text(), 10) > 1) {
            $(this).parent("tr").css("background-color", "red");
        }
      });
    });

    $('#data').on('page.dt', function () {
      $("#data td:nth-child(3)").each(function () {
        if (parseInt($(this).text(), 10) > 1) {
            $(this).parent("tr").css("background-color", "red");
        }
      });
    })

    $('#data').on('order.dt', function () {
      $("#data td:nth-child(3)").each(function () {
        if (parseFloat($(this).text(), 10) > 1) {
            $(this).parent("tr").css("background-color", "red");
        }
      });
    })

    $('#data').on('search.dt', function () {
      $("#data td:nth-child(3)").each(function () {
        if (parseInt($(this).text(), 10) > 1) {
            $(this).parent("tr").css("background-color", "red");
        }
      });
    })


    $('#data tbody').on('click', 'button', function () {
      var nodeName = $(this)[0].childNodes[0].parentNode.parentElement.parentNode.childNodes[1].childNodes[0].data;
      console.log(nodeName);

      $.ajax({
        type: "GET",
        url: "draw_duration",
        data: {node_name: nodeName}
      }).done(function(fig_path) {
        var fig_tag = "<img class='img-responsive'  src='" + fig_path + "'/>"
        $('#putFig').html(fig_tag);
        const popUp = new bootstrap.Modal('#durationFig', options);
        popUp.show();
      });

    });


  </script>
{% endblock %}